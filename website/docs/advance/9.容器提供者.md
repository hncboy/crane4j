## 9.0.概述

![image-20230311184930927](./image-20230311184930927.png)

容器提供者 `ContainerProvider` 是用于隔离数据源，并且对数据源获取途径进行增强的组件，它可以简单的理解为数据源容器的容器，比如 `Crane4j` 的全局配置类 `Crane4jGlobalConfiguration` 本身就是一个 `ContainerProvider`。

当解析器解析配置得到用户指定的 `namespace` 时，会：

- 先从全局配置类/上下文找到指定的 `ContainerProvider`；
- 若有必要，`ContainerProvider` 先对 `namespace` 进行解析（比如表达式或者方法调用）；
- `ContainerProvider` 使用解析后的 `namespace` 寻找已注册的容器；

不同的数据源将会根据其所属的 `ContainerProvider` 彼此隔离，第三方的框架接入时只需提供自己的 `ContainerProvider` 即可，不必担心影响其他的数据源。比如，项目中可能有多个数据源，这种情况下同样用于提供用户信息的容器 `userContainer` ，可能就需要同时存在两个，并且指向不同的数据源，此时即可根据 `ContainerProvider` 进行区分。

## 9.1.注册

容器提供者目前只支持基于 Spring 的自动装配进行注册，用户可以实现 `ContainerProvider` 接口并通过 `@Bean` 方法或者在类上添加 `@Component` 注解的方式，将自定义的 `ContainerProvider` 注册到 Spring 上下文中，当使用的时候 `crane4j` 会自己通过 Spring 获取。

## 9.2.使用

用户可通过 `@Assemble` 注解的 `provider` 或 `providerName` 属性指定该装配操作的容器从哪个提供者获取，比如：

~~~java
public class UserVO {
    @Assemble(
        container = "user", provider = fooProvider.class,
        props = @Mapping(src = "name", ref = "name")
    )
    private Integer id;
    private String name;
}
~~~

当配置解析时，`crane4j` 将从用户指定的 `fooProvider` 获取 `namespace` 为 `user` 的数据源容器。

目前 `crane4j` 仅有默认的 `Crane4jGlobalConfiguration` 和 `MybatisPlus` 扩展使用的 `MpMethodContainerProvider` 两个容器供应者。
